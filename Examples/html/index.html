<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta charset="utf-8" />
	<title>Menu</title>

	<!--for mobile devices-->
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

	<meta name="author" content="Andrej Hristoliubov https://anhr.github.io/AboutMe/">

	<!-- ===============================global links=============================================== -->

	<!--<script src="https://raw.githack.com/anhr/DropdownMenu/master/build/dropdownMenu.js"></script>-->
	<!--<script src="https://raw.githack.com/anhr/DropdownMenu/master/build/dropdownMenu.min.js"></script>-->

	<!--<script src="https://raw.githack.com/anhr/menuPlay/master/build/menuPlay.js"></script>-->
	<!--<script src="https://raw.githack.com/anhr/menuPlay/master/build/menuPlay.min.js"></script>-->

	<!--Three.js-->
	<!--
	<script src="https://raw.githack.com/anhr/three.js/dev/build/three.js"></script>
	<script src="https://raw.githack.com/anhr/three.js/dev/examples/js/WebGL.js"></script>
	<script src="https://raw.githack.com/anhr/three.js/dev/examples/js/controls/OrbitControls.js"></script>
	-->

	<!--A lightweight graphical user interface for changing variables in JavaScript. https://github.com/dataarts/dat.gui -->
	<!--В настоящее время в
		https://raw.githack.com/anhr/dat.gui/CustomController/build/dat.gui.js
		находится старая версия dat.gui.js потому что я делаю pull request
		https://github.com/dataarts/dat.gui/pull/232 в котором пользователь donmccurdy просит удалить все файлы из папки build.
		Поэтому я перенушу свежую версию dat.gui.js и dat.gui.min.js из
		D:\My documents\MyProjects\webgl\three.js\GitHub\dat.gui\build
		в
		D:\My documents\MyProjects\webgl\three.js\GitHub\three.js\examples\js\libs
		и обновляю ветку dev three.js github
		-->
	<!--<script src="https://raw.githack.com/anhr/three.js/dev/examples/js/libs/dat.gui.js"></script>-->
	<!--<script src="https://raw.githack.com/anhr/three.js/dev/examples/js/effects/StereoEffect.js"></script>-->

	<!--Cube-->
	<!--
	<script src="https://raw.githack.com/anhr/three.js/dev/examples/js/geometries/ConvexGeometry.js"></script>
	<script src="https://raw.githack.com/anhr/three.js/dev/examples/js/QuickHull.js"></script>
	-->

	<!--Attention! Load controllerPlay.js file after StereoEffect.js if you want to localise controllerPlay buttons -->
	<!--<script src="https://raw.githack.com/anhr/controllerPlay/master/build/controllerPlay.js"></script>-->
	<!--<script src="https://raw.githack.com/anhr/controllerPlay/master/build/controllerPlay.min.js"></script>-->

	<!-- ================================local links======================================== -->

	<!--For mobile device debugging-->
	<!--<script src="../../../nodejs/dropdownMenu/build/dropdownMenu.js"></script>-->
	<!--For desktop debugging-->
	<!--<script src="http://localhost/nodejs/dropdownMenu/build/dropdownMenu.js"></script>-->
	<!--<script src="../../build/dropdownMenu.min.js"></script>-->

	<script src="http://localhost/nodejs/menuPlay/build/menuPlay.js"></script>
	<!--<script src="http://localhost/nodejs/menuPlay/build/menuPlay.min.js"></script>-->

	<!--Three.js-->
	<script src="http://localhost/threejs/three.js/build/three.js"></script>
	<script src="http://localhost/threejs/three.js/examples/js/WebGL.js"></script>
	<script src="http://localhost/threejs/three.js/examples/js/controls/OrbitControls.js"></script>

	<!--A lightweight graphical user interface for changing variables in JavaScript. https://github.com/dataarts/dat.gui -->
	<script src="http://localhost/threejs/dat.gui/build/dat.gui.js"></script>

	<script src="http://localhost/threejs/three.js/examples/js/effects/StereoEffect.js"></script>

	<!--Cube-->
	<script src="http://localhost/threejs/three.js/examples/js/geometries/ConvexGeometry.js"></script>
	<script src="http://localhost/threejs/three.js/examples/js/QuickHull.js"></script>

	<!--Attention! Load controllerPlay.js file after StereoEffect.js if you want to localise controllerPlay buttons -->
	<script src="http://localhost/nodejs/controllerPlay/build/controllerPlay.js"></script>
	<!--<script src="http://localhost/nodejs/controllerPlay/build/controllerPlay.min.js"></script>-->

	<!-- ============================================================================== -->

	<!--Attention! Load custom.css file after dropdownMenu.js file for correctly priority of the styles-->
	<link rel="stylesheet" href="http://localhost/nodejs/dropdownMenu/styles/gui.css" type="text/css">

</head>
	<body>
		<p>
			<a href='https://anhr.github.io/index.html' target="_blank">Home</a>
			| <a href='https://github.com/anhr/controllerPlay' target="_blank">GitHub</a>
		</p>
		<h1>node.js version of the controllerPlay.</h1>

	<h2>
		Dropdown menu inside <a href="https://threejs.org/" target="_blank">Three.js</a> canvas.
		<a href="../../styles/Decorations/transparent.css" target="_blank"> Transparent decoration</a>.
	</h2>
	<p>Please move mouse over canvas. Now you can see "⚭" and "⤢" buttons on the bottom of the canvas.</p>

	<div class="container" id="containerDSE">
		<canvas id="canvas"></canvas>
		<!--Thanks to https://stackoverflow.com/questions/41404643/place-dat-gui-strictly-inside-three-js-scene-without-iframe-->
		<div id="iframe-goes-in-here">
			<div id="my-gui-container"></div>
			<!--<iframe></iframe>-->
		</div>
	</div>
	<script>

		if ( WEBGL.isWebGLAvailable() === false ) {

			document.body.appendChild( WEBGL.getWebGLErrorMessage() );
			alert( WEBGL.getWebGLErrorMessage().innerHTML );

		}

		var elContainer = document.getElementById( "containerDSE" ),
			elCanvas = elContainer.querySelector( 'canvas' );


		function createMenu() {

			if ( typeof menuPlay !== 'undefined' )
				menuPlay.create( elContainer, elCanvas, {

					stereoEffect: stereoEffect,

				} );

		}

		var camera, scene, renderer, controls, stereoEffect/*, raycaster*/, cubeType = 'cube', group, playController;
/*
		try {

			init();
			animate();
			createMenu();

		} catch ( e ) {

			alert( 'init failed! ' + e.message );

		}
*/
		init();
		animate();
		createMenu();

		function init() {

			// CAMERA

			camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 0.01, 10 );
			camera.position.set( 0.4, 0.4, 2 );

			// SCENE

			scene = new THREE.Scene();
			scene.background = new THREE.Color( 0x000000 );
			scene.fog = new THREE.Fog( 0x000000, 250, 1400 );

			//

			renderer = new THREE.WebGLRenderer( {

				antialias: true,
				canvas: elCanvas,

			} );
			renderer.setPixelRatio( window.devicePixelRatio );

			//resize
			renderer.setSizeOld = renderer.setSize;
			renderer.setSize = function ( width, height, updateStyle ) {

				renderer.setSizeOld( width, height, updateStyle );

				timeoutControls = setTimeout( function () {

					elContainer.style.height = elCanvas.style.height;//height + "px";
					elContainer.style.width = elCanvas.style.width;//width + "px";
					elContainer.style.left = elCanvas.style.left;
					elContainer.style.top = elCanvas.style.top;
					elContainer.style.position = elCanvas.style.position;

					if ( typeof menuPlay !== 'undefined' )
						menuPlay.setSize( width, height );

				}, 0 );

			};
			renderer.setSize( window.innerWidth / 2, window.innerHeight / 2 );

			//
			controls = new THREE.OrbitControls( camera, renderer.domElement );
			controls.target.set( 0, 0, 0 );
			controls.update();

			//StereoEffect
			stereoEffect = new THREE.StereoEffect( renderer, {

				spatialMultiplex: THREE.StereoEffectParameters.spatialMultiplexsIndexs.Mono, //.SbS,
				far: camera.far,
				camera: camera,
				stereoAspect: 1,
				rememberSize: true,
				onFullScreen: function ( fullScreen ) {

					setFullScreenButton( fullScreen );

				},
				cookie: THREE.cookie,

			} );
			stereoEffect.options.spatialMultiplex = THREE.StereoEffectParameters.spatialMultiplexsIndexs.Mono;

			//Light

			var light = new THREE.PointLight( 0xffffff, 1 );
			light.position.copy( new THREE.Vector3( 1, 1, 1 ) );
			scene.add( light );

			light = new THREE.PointLight( 0xffffff, 1 );
			light.position.copy( new THREE.Vector3( -2, -2, -2 ) );
			scene.add( light );
/*
			//raycaster

			raycaster = new THREE.Raycaster();
			raycaster.params.Points.threshold = 0.03;
			raycaster.setStereoEffect( {

				renderer: renderer,
				stereoEffect: stereoEffect,
				onIntersection: function ( intersects ) {

					onIntersection( intersects );

				},
				onIntersectionOut: function ( intersects ) {

					onIntersectionOut( intersects );

				},
				onMouseDown: function ( intersects ) {

					onMouseDown( intersects );

				}

			} );
*/
			group = new THREE.Group();
			scene.add( group );

			//dat-gui JavaScript Controller Library
			//https://github.com/dataarts/dat.gui
	//			var gui = new dat.GUI();
			var gui = new dat.GUI( {

				autoPlace: false,
				//			closed: true,//Icorrect "Open Controls" button name

			} );

			//Close gui window
			if ( gui.__closeButton.click !== undefined )//for compatibility with Safari 5.1.7 for Windows
				gui.__closeButton.click();

			//Thanks to https://stackoverflow.com/questions/41404643/place-dat-gui-strictly-inside-three-js-scene-without-iframe
			document.getElementById( 'my-gui-container' ).appendChild( gui.domElement );

			//PlayController
			var colorRed = new THREE.Color( 0xff0000 );
			playController = controllerPlay.create( group, {

				onShowObject3D: function ( objects3DItem, index ) {

					objects3DItem.visible = true;
					if ( typeof menuPlay !== "undefined" )
						menuPlay.setIndex( index );

				},
				onHideObject3D: function ( objects3DItem ) {

					objects3DItem.visible = false;//hide object3D

				},
				onSelectedObject3D: function ( objects3DItem, index ) {

					objects3DItem.material.color = colorRed;
					objects3DItem.visible = true;
					if ( typeof menuPlay !== "undefined" )
						menuPlay.setIndex( index );

				},
				onRestoreObject3D: function ( objects3DItem ) {

					objects3DItem.material.color = objects3DItem.userData.color;
					objects3DItem.visible = true;

				},
				onRenamePlayButton: function ( name, title ) {

					var elMenuButtonPlay = document.getElementById( 'menuButtonPlay' );
					if ( elMenuButtonPlay === null )
						return;
					elMenuButtonPlay.innerHTML = name;
					elMenuButtonPlay.title = title;

				},
				onRenameRepeatButton: function ( title, color ) {

					var elMenuButtonRepeat = document.getElementById( 'menuButtonRepeat' );
					if ( elMenuButtonRepeat === null )
						return;
//					elMenuButtonRepeat.innerHTML = name;
					elMenuButtonRepeat.title = title;

				},

			} );
			gui.add( playController );

			//Points

			var points = new THREE.Points( new THREE.BufferGeometry().setFromPoints( [
				new THREE.Vector3( 0, 0, 0 ),
				new THREE.Vector3( 0, 0.5, -1 ),
				new THREE.Vector3( 0.5, 0, 1 ),
			] ),
				new THREE.PointsMaterial( {

					color: 0xffffff,
					size: 0.05,
					alphaTest: 0.5

				} ) );
			points.position.copy( new THREE.Vector3( 0.1, 0.2, 0 ) );
			points.scale.copy( new THREE.Vector3( 2, 2, 1 ) );
			points.userData.color = points.material.color;
			//			scene.add( points );
			group.add( points );

			//cubes

			function addCube( cubePosition, color ) {

				var cube = new THREE.Mesh( new THREE.ConvexBufferGeometry( new THREE.CubeGeometry( 0.4, 0.4, 0.4 ).vertices ),
					new THREE.MeshLambertMaterial( {
						color: color,
						/*
						opacity: 0.5,
						transparent: true,
						*/
					} ) );
				cube.position.copy( cubePosition );
				cube.type = cubeType;
				cube.userData.color = cube.material.color;
				group.add( cube );

/*
				if ( raycaster.stereo !== undefined )
					raycaster.stereo.addParticles( cube );
*/

			}
			addCube( new THREE.Vector3( -1, 0, 0 ), 0xffffff );
			addCube( new THREE.Vector3( -0.5, 0.5, -0.5 ), 'green' );

			if ( ( stereoEffect !== undefined ) && ( typeof gui !== 'undefined' ) )
				THREE.gui.stereoEffect( gui, stereoEffect.options, {

					gui: gui,
					stereoEffect: stereoEffect,

				} );

			window.addEventListener( 'resize', onResize, false );

		}
		function onResize() {

			var size = new THREE.Vector2();
			renderer.getSize( size );
			camera.aspect = size.x / size.y;
			camera.updateProjectionMatrix();

			if ( typeof se === 'undefined' )
				renderer.setSize( size.x, size.y );
			else
				stereoEffect.setSize( size.x, size.y );

		}
		function onDocumentMouseMove( event ) {

			/*if ( raycaster.stereo !== undefined )
				raycaster.stereo.onDocumentMouseMove( event );
			else */{

				// Test of the old version of THREE.Raycaster
				event.preventDefault();
				var left = renderer.domElement.offsetLeft,
					top = renderer.domElement.offsetTop,
					size = new THREE.Vector2;
				renderer.getSize( size );
				mouse.x = ( event.clientX / size.x ) * 2 - 1 - ( left / size.x ) * 2;
				mouse.y = -( event.clientY / size.y ) * 2 + 1 + ( top / size.y ) * 2;

			}
			if ( event.buttons != 1 )
				return;

			render();

		}
		function onDocumentMouseDown( event ) {

/*
			if ( raycaster.stereo !== undefined )
				raycaster.stereo.onDocumentMouseDown( event );
*/

		}
		function animate() {

			requestAnimationFrame( animate );

			render();

		}

		function render() {

			if ( typeof stereoEffect === 'undefined' )
				renderer.render( scene, camera );
			else stereoEffect.render( scene, camera );

		}

		var canvasMouseOver = false,
			elControls = elContainer.querySelectorAll( '.controls' ),
			timeoutControls;

		function setFullScreenButton( fullScreen ) {

			var elMenuButtonFullScreen = document.getElementById( 'menuButtonFullScreen' );
			if ( elMenuButtonFullScreen === null )
				return;

			if ( fullScreen === undefined )
				fullScreen = !( ( stereoEffect === undefined ) || !stereoEffect.isFullScreen() );
			if ( fullScreen ) {

				elMenuButtonFullScreen.innerHTML = '⤦';
				elMenuButtonFullScreen.title = 'Non Full Screen';

			} else {

				elMenuButtonFullScreen.innerHTML = '⤢';
				elMenuButtonFullScreen.title = 'Full Screen';

			}

		}
	</script>
	</body>
</html>
